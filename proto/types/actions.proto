syntax = "proto3";
package df.plugin;

option go_package = "github.com/secmc/plugin/proto/generated";

import "common.proto";

message ActionBatch {
    repeated Action actions = 1;
}

message Action {
    optional string correlation_id = 1;
    oneof kind {
        SendChatAction send_chat = 10;
        TeleportAction teleport = 11;
        KickAction kick = 12;
        SetGameModeAction set_game_mode = 13;
        // Inventory & Items
        GiveItemAction give_item = 14;
        ClearInventoryAction clear_inventory = 15;
        SetHeldItemAction set_held_item = 16;
        // Player State
        SetHealthAction set_health = 20;
        SetFoodAction set_food = 21;
        SetExperienceAction set_experience = 22;
        SetVelocityAction set_velocity = 23;
        // Effects & Status
        AddEffectAction add_effect = 30;
        RemoveEffectAction remove_effect = 31;
        // UI & Communication
        SendTitleAction send_title = 40;
        SendPopupAction send_popup = 41;
        SendTipAction send_tip = 42;
        PlaySoundAction play_sound = 43;
        // Commands
        ExecuteCommandAction execute_command = 50;
        // World configuration and effects
        WorldSetDefaultGameModeAction world_set_default_game_mode = 60;
        WorldSetDifficultyAction world_set_difficulty = 61;
        WorldSetTickRangeAction world_set_tick_range = 62;
        WorldSetBlockAction world_set_block = 63;
        WorldPlaySoundAction world_play_sound = 64;
        WorldAddParticleAction world_add_particle = 65;
        // World queries
        WorldQueryEntitiesAction world_query_entities = 70;
        WorldQueryPlayersAction world_query_players = 71;
        WorldQueryEntitiesWithinAction world_query_entities_within = 72;
    }
}

message SendChatAction {
    string target_uuid = 1;
    string message = 2;
}

message TeleportAction {
    string player_uuid = 1;
    Vec3 position = 2;
    // rotation vector mapping:
    //  x = pitch, y = yaw, z = head_yaw
    Vec3 rotation = 3;
}

message KickAction {
    string player_uuid = 1;
    string reason = 2;
}

message SetGameModeAction {
    string player_uuid = 1;
    GameMode game_mode = 2;
}

// Inventory & Items
message GiveItemAction {
    string player_uuid = 1;
    ItemStack item = 2;
}

message ClearInventoryAction {
    string player_uuid = 1;
}

message SetHeldItemAction {
    string player_uuid = 1;
    optional ItemStack main = 2;    // if set, updates main hand
    optional ItemStack offhand = 3; // if set, updates offhand
}

// Player State
message SetHealthAction {
    string player_uuid = 1;
    double health = 2;
    optional double max_health = 3;
}

message SetFoodAction {
    string player_uuid = 1;
    int32 food = 2; // 0-20
}

message SetExperienceAction {
    string player_uuid = 1;
    // If set, the player's level is set to this value.
    optional int32 level = 2;
    // If set, the player's progress bar (0..1) is set to this value.
    optional float progress = 3;
    // If set, raw experience points are added (can be negative to remove).
    optional int32 amount = 4;
}

message SetVelocityAction {
    string player_uuid = 1;
    Vec3 velocity = 2;
}

// Effects & Status
message AddEffectAction {
    string player_uuid = 1;
    EffectType effect_type = 2;
    int32 level = 3;        // amplifier level (1 = level I)
    int64 duration_ms = 4;  // duration in milliseconds
    bool show_particles = 5;
}

message RemoveEffectAction {
    string player_uuid = 1;
    EffectType effect_type = 2;
}

// UI & Communication
message SendTitleAction {
    string player_uuid = 1;
    string title = 2;
    optional string subtitle = 3;
    optional int64 fade_in_ms = 4;
    optional int64 duration_ms = 5;
    optional int64 fade_out_ms = 6;
}

message SendPopupAction {
    string player_uuid = 1;
    string message = 2;
}

message SendTipAction {
    string player_uuid = 1;
    string message = 2;
}

message PlaySoundAction { // TODO: it should probably be a world action
    string player_uuid = 1;
    Sound sound = 2;
    optional Vec3 position = 3;  // defaults to player position if unset
    optional float volume = 4;   // default 1.0
    optional float pitch = 5;    // default 1.0
}

// Commands
message ExecuteCommandAction {
    string player_uuid = 1;
    string command = 2; // without leading slash
}

message WorldSetDefaultGameModeAction {
    WorldRef world = 1;
    GameMode game_mode = 2;
}

message WorldSetDifficultyAction {
    WorldRef world = 1;
    Difficulty difficulty = 2;
}

message WorldSetTickRangeAction {
    WorldRef world = 1;
    int32 tick_range = 2;
}

message WorldSetBlockAction {
    WorldRef world = 1;
    BlockPos position = 2;
    optional BlockState block = 3; // nil clears to air
}

message WorldPlaySoundAction {
    WorldRef world = 1;
    Sound sound = 2;
    Vec3 position = 3;
}

message WorldAddParticleAction {
    WorldRef world = 1;
    Vec3 position = 2;
    ParticleType particle = 3;
    optional BlockState block = 4; // used for block-based particles when provided
    optional int32 face = 5; // used for punch_block when provided
}

enum ParticleType {
    PARTICLE_TYPE_UNSPECIFIED = 0;
    PARTICLE_HUGE_EXPLOSION = 1;
    PARTICLE_ENDERMAN_TELEPORT = 2;
    PARTICLE_SNOWBALL_POOF = 3;
    PARTICLE_EGG_SMASH = 4;
    PARTICLE_SPLASH = 5;
    PARTICLE_EFFECT = 6;
    PARTICLE_ENTITY_FLAME = 7;
    PARTICLE_FLAME = 8;
    PARTICLE_DUST = 9;
    PARTICLE_BLOCK_FORCE_FIELD = 10;
    PARTICLE_BONE_MEAL = 11;
    PARTICLE_EVAPORATE = 12;
    PARTICLE_WATER_DRIP = 13;
    PARTICLE_LAVA_DRIP = 14;
    PARTICLE_LAVA = 15;
    PARTICLE_DUST_PLUME = 16;
    PARTICLE_BLOCK_BREAK = 17;
    PARTICLE_PUNCH_BLOCK = 18;
}

message WorldQueryEntitiesAction {
    WorldRef world = 1;
}

message WorldQueryPlayersAction {
    WorldRef world = 1;
}

message WorldQueryEntitiesWithinAction {
    WorldRef world = 1;
    BBox box = 2;
}

message ActionStatus {
    bool ok = 1;
    optional string error = 2;
}

message WorldEntitiesResult {
    WorldRef world = 1;
    repeated EntityRef entities = 2;
}

message WorldEntitiesWithinResult {
    WorldRef world = 1;
    BBox box = 2;
    repeated EntityRef entities = 3;
}

message WorldPlayersResult {
    WorldRef world = 1;
    repeated EntityRef players = 2;
}

message ActionResult {
    string correlation_id = 1;
    optional ActionStatus status = 2;
    oneof result {
        WorldEntitiesResult world_entities = 10;
        WorldPlayersResult world_players = 11;
        WorldEntitiesWithinResult world_entities_within = 12;
    }
}
